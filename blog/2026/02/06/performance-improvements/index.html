<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Making Pyrefly Diagnostics 18x Faster | Pyrefly</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pyrefly.org/blog/2026/02/06/performance-improvements/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Making Pyrefly Diagnostics 18x Faster | Pyrefly"><meta data-rh="true" name="description" content="Learn about the recent performance improvements made to Pyrefly&#x27;s language server capabilities"><meta data-rh="true" property="og:description" content="Learn about the recent performance improvements made to Pyrefly&#x27;s language server capabilities"><meta data-rh="true" property="og:image" content="https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png"><meta data-rh="true" name="twitter:image" content="https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-02-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/javabster,https://www.kylei.dev/,https://github.com/yangdanny97"><meta data-rh="true" property="article:tag" content="language-server,IDE,performance"><link data-rh="true" rel="canonical" href="https://pyrefly.org/blog/2026/02/06/performance-improvements/"><link data-rh="true" rel="alternate" href="https://pyrefly.org/blog/2026/02/06/performance-improvements/" hreflang="en"><link data-rh="true" rel="alternate" href="https://pyrefly.org/blog/2026/02/06/performance-improvements/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://pyrefly.org/blog/2026/02/06/performance-improvements","mainEntityOfPage":"https://pyrefly.org/blog/2026/02/06/performance-improvements","url":"https://pyrefly.org/blog/2026/02/06/performance-improvements","headline":"Making Pyrefly Diagnostics 18x Faster","name":"Making Pyrefly Diagnostics 18x Faster","description":"Learn about the recent performance improvements made to Pyrefly's language server capabilities","datePublished":"2026-02-06T00:00:00.000Z","author":[{"@type":"Person","name":"Abby Mitchell","url":"https://github.com/javabster"},{"@type":"Person","name":"Kyle Into","url":"https://www.kylei.dev/"},{"@type":"Person","name":"Danny Yang","url":"https://github.com/yangdanny97"}],"image":{"@type":"ImageObject","@id":"https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png","url":"https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png","contentUrl":"https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png","caption":"title image for the blog post: Making Pyrefly Diagnostics 18x Faster"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://pyrefly.org/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Pyrefly RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Pyrefly Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GSX14JC495"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GSX14JC495",{anonymize_ip:!0})</script>











<link rel="stylesheet" href="/stylex.css">


<link rel="icon" href="/img/Pyrefly-Symbol.svg" type="image/svg" sizes="32x32" media="(prefers-color-scheme: light)">
<link rel="icon" href="/img/Pyrefly-Symbol-Invert.svg" type="image/svg" sizes="32x32" media="(prefers-color-scheme: dark)">
<meta property="og:image" content="/img/Pyrefly-Preview-Symbol.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/png">
<link rel="stylesheet" href="/css/code-block-buttons.css">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="/js/code-block-buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.2ccc2416.css">
<script src="/assets/js/runtime~main.6bc40480.js" defer="defer"></script>
<script src="/assets/js/main.8f975202.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Pyrefly-Symbol.svg" alt="Pyrefly Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="24" width="24"><img src="/img/Pyrefly-Symbol-Invert.svg" alt="Pyrefly Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="24" width="24"></div><b class="navbar__title text--truncate">Pyrefly</b></a><a class="navbar__item navbar__link" href="/en/docs/">Docs</a><a class="navbar__item navbar__link" href="/en/docs/typing-for-python-developers/">Learn</a><a class="navbar__item navbar__link" href="/sandbox/">Sandbox</a><a class="navbar__item navbar__link" href="/en/docs/installation/">Install</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/pyrefly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon github__link" aria-label="GitHub"></a><a href="https://discord.gg/Cf7mFQtW7W" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon discord__link" aria-label="Discord"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2026/02/06/performance-improvements/">Making Pyrefly Diagnostics 18x Faster</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/type-narrowing/">4 Pyrefly Type Narrowing Patterns that make Type Checking more Intuitive</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pyrefly-pydantic/">Fly through data validation with Pyrefly’s new Pydantic integration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pyrefly-beta/">Pyrefly Beta is here!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/numpy-type-completeness/">Bringing NumPy&#x27;s type-completeness score to nearly 90%</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/09/15/ide-extension/">Give your Python IDE a Glow-Up with Pyrefly</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/why-typed-python/">Why Today’s Python Developers Are Embracing Type Hints</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-pyrefly/">Introducing Pyrefly - A new type checker and IDE experience for Python</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Making Pyrefly Diagnostics 18x Faster</h1><div class="container_mt6G margin-vert--md"><time datetime="2026-02-06T00:00:00.000Z">February 6, 2026</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/javabster" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Abby Mitchell</span></a></div><div class="authorSocials_rSDt"></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://www.kylei.dev/" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Kyle Into</span></a></div><div class="authorSocials_rSDt"></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/yangdanny97" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Danny Yang</span></a></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" alt="Hero image" src="/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png" width="1216" height="644" class="img_ev3q"></p>
<p>As we move closer to a stable release of Pyrefly, our efforts have moved from expanding the language server’s capabilities to tackling performance edge cases. Recently, our friends at Astral <a href="https://astral.sh/blog/ty" target="_blank" rel="noopener noreferrer">alerted us to a specific edge case</a> that is a great example of the kind of issues we’ve been aiming to uncover. The specific example Astral highlighted showed that in some edge cases Pyrefly could take multiple seconds to update diagnostics after editing. This is much slower than expected (used across Meta’s codebases, Pyrefly usually takes less than 10 milliseconds to recheck files after saving them) and prompted us to investigate further.</p>
<p>Now we’d like to share the story of how that edge case led us to rethink our underlying approach to diagnostics and dependency tracking, improving the speed at which Pyrefly&#x27;s type errors update by 18x in the process.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a href="#the-problem" class="hash-link" aria-label="Direct link to The Problem" title="Direct link to The Problem">​</a></h2>
<p>Say you’re working in a very large codebase and have two files open in your editor, A and B.</p>
<ul>
<li>A is a “load-bearing” file that has many reverse dependencies - that is to say, many files directly or transitively import A.</li>
<li>B is one of the files that imports A.</li>
</ul>
<p>Incremental type checking should be snappy - when you edit A and save the file, any effects on the type errors in B should be reflected almost instantly. However, in a small number of cases, we found that updates could take multiple seconds.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-incremental-updates-work-in-pyrefly">How Incremental Updates Work in Pyrefly<a href="#how-incremental-updates-work-in-pyrefly" class="hash-link" aria-label="Direct link to How Incremental Updates Work in Pyrefly" title="Direct link to How Incremental Updates Work in Pyrefly">​</a></h3>
<p>To understand how this problem arises, we need to look at how incremental updates currently work. Pyrefly’s analysis operates at the module level, meaning it keeps track of the types exported from each module, as well as the dependencies between modules. Let’s illustrate with a simple example.</p>
<p><img decoding="async" loading="lazy" alt="import diagram" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjE5NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQxcHg7aGVpZ2h0OjE5NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0MSAxOTQiIHdpZHRoPSI2NDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgQS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9BIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY4Ljg5MDYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkxLjMxMjUiIHg9IjI3Ny41IiB5PSIxMjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMS4xOTkyIiB4PSIyODcuNSIgeT0iMTQyLjk5NTEiPkEucHk8L3RleHQ+PHRleHQgZmlsbD0iI0ZGMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuMzEyNSIgeD0iMjg3LjUiIHk9IjE1OS4yOTIiPmNsYXNzIFg6IC4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MC4yNzM0IiB4PSIyODcuNSIgeT0iMTc1LjU4ODkiPmNsYXNzIFk6IC4uLjwvdGV4dD48L2c+PCEtLWVudGl0eSBCMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfQjEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMxLjYzMDkiIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC4xMzM4IiB4PSIxNyIgeT0iMjkuOTk1MSI+QjEucHk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjYzMDkiIHg9IjE3IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgWDwvdGV4dD48L2c+PCEtLWVudGl0eSBCMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMiIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfQjIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMwLjU5MTgiIHg9IjE3NC41IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iMTg0LjUiIHk9IjI5Ljk5NTEiPkIyLnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC41OTE4IiB4PSIxODQuNSIgeT0iNDYuMjkyIj5mcm9tIEEgaW1wb3J0IFk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQjMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQjMiIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0IzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC41OTE4IiB4PSIzNDAuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjM1MC41IiB5PSIyOS45OTUxIj5CMy5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNTkxOCIgeD0iMzUwLjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCBZPC90ZXh0PjwvZz48IS0tZW50aXR5IEI0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkI0IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV9CNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuMDQiIHg9IjUwNi41IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iNTE2LjUiIHk9IjI5Ljk5NTEiPkI0LnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS4wNCIgeD0iNTE2LjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCAqPC90ZXh0PjwvZz48IS0tbGluayBCMSB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIxIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgZGF0YS11aWQ9ImxuazciIGlkPSJsaW5rX0IxX0EiPjxwYXRoIGQ9Ik0xMjYuNjMsNjAuMDMgQzE3MS41NCw4MS40IDIyOS41MTIyLDEwOS4wMDE4IDI3Mi4wMDIyLDEyOS4yMjE4IiBmaWxsPSJub25lIiBpZD0iQjEtdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMjc3LjQyLDEzMS44LDI3MS4wMTIxLDEyNC4zMjA4LDI3Mi45MDUxLDEyOS42NTE1LDI2Ny41NzQ1LDEzMS41NDQ2LDI3Ny40MiwxMzEuOCIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBCMiB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIyIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImxuazgiIGlkPSJsaW5rX0IyX0EiPjxwYXRoIGQ9Ik0yNTcuODEsNjAuMDMgQzI3MCw3Ny41MSAyODIuODY3OSw5NS45NTg1IDI5Ni4xMTc5LDExNC45NTg1IiBmaWxsPSJub25lIiBpZD0iQjItdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMjk5LjU1LDExOS44OCwyOTcuNjgyOSwxMTAuMjA5NywyOTYuNjg5OSwxMTUuNzc4OCwyOTEuMTIwOSwxMTQuNzg1OCwyOTkuNTUsMTE5Ljg4IiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEIzIHRvIEEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQjMiIGRhdGEtZW50aXR5LTI9IkEiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0ibG5rOSIgaWQ9ImxpbmtfQjNfQSI+PHBhdGggZD0iTTM4OC4xOSw2MC4wMyBDMzc2LDc3LjUxIDM2My4xMzIxLDk1Ljk1ODUgMzQ5Ljg4MjEsMTE0Ljk1ODUiIGZpbGw9Im5vbmUiIGlkPSJCMy10by1BIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iI0ZGMDAwMCIgcG9pbnRzPSIzNDYuNDUsMTE5Ljg4LDM1NC44NzkxLDExNC43ODU4LDM0OS4zMTAxLDExNS43Nzg4LDM0OC4zMTcxLDExMC4yMDk3LDM0Ni40NSwxMTkuODgiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQjQgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCNCIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGRhdGEtdWlkPSJsbmsxMCIgaWQ9ImxpbmtfQjRfQSI+PHBhdGggZD0iTTUxNy44LDYwLjAzIEM0NzMuMzksODEuMzQgNDE2LjE3OTIsMTA4Ljc4MzggMzc0LjAyOTIsMTI5LjAxMzgiIGZpbGw9Im5vbmUiIGlkPSJCNC10by1BIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iI0ZGMDAwMCIgcG9pbnRzPSIzNjguNjIsMTMxLjYxLDM3OC40NjQ2LDEzMS4zMjE5LDM3My4xMjc3LDEyOS40NDY1LDM3NS4wMDMxLDEyNC4xMDk2LDM2OC42MiwxMzEuNjEiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bVFN2MTJlQ200ME5HVkt1bmsyb09lZDRiOFhXbGVVMGNRNWdhY2VJOUs0aGZ0UGljTTJsT3RWM19vc0ppUkxINmU5VzFQUnk4VFBxYUYwYTBycFg4aEZNYXFKSzNVSDd4YkhNWWxjX0x6WjJnZzdicWdrV19OVXd3aWYtNGpUM2FHMmFqcFp1bEVuTklyZ1NIMjBsTHhuQVUtMnFOckV1aDY2VVpTTzc2RXZ4aU83ZTBzbTNKN01KXzhUbDF4MDJVMGltOEpvMkVJdFNpSnpVMWhLQ01YWlMwXS0tPjwvZz48L3N2Zz4=" width="641" height="194" class="img_ev3q"></p>
<p>The above image demonstrates a file A that has 4 reverse-dependencies. B1-B4 all rely on the types exported from A.</p>
<p>When file A is edited &amp; saved, we recheck A to see if any of its exported types also change. If so, we recheck every file that imports A (and if any of those files’ exports changed, we recheck their dependencies, and so on until the change to A has been successfully propagated everywhere). After all of that finishes, we display updated errors in the IDE.</p>
<p>There are two key observations here:</p>
<ol>
<li>Our dependency tracking rechecks a module when <em>any</em> export changes, even if the module does not depend on the export that changed. This can lead to modules being rechecked unnecessarily.</li>
<li>We are waiting until the update has completely propagated to every affected file before sending any updated diagnostics, when in practice we mostly care about the files the user has open.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-1-fine-grained-dependency-tracking">Solution 1: Fine-grained dependency tracking<a href="#solution-1-fine-grained-dependency-tracking" class="hash-link" aria-label="Direct link to Solution 1: Fine-grained dependency tracking" title="Direct link to Solution 1: Fine-grained dependency tracking">​</a></h2>
<p>Instead of just tracking whether or not a module depends on another module for invalidation, we can specifically track what’s used.</p>
<p>Looking again at the example above, instead of rechecking everything that imports A, with smarter dependency tracking we could only recheck a subset of relevant files:</p>
<p><img decoding="async" loading="lazy" alt="import diagram improved" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjE5NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQxcHg7aGVpZ2h0OjE5NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0MSAxOTQiIHdpZHRoPSI2NDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgQS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9BIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY4Ljg5MDYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkxLjMxMjUiIHg9IjI3Ny41IiB5PSIxMjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMS4xOTkyIiB4PSIyODcuNSIgeT0iMTQyLjk5NTEiPkEucHk8L3RleHQ+PHRleHQgZmlsbD0iI0ZGMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuMzEyNSIgeD0iMjg3LjUiIHk9IjE1OS4yOTIiPmNsYXNzIFg6IC4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MC4yNzM0IiB4PSIyODcuNSIgeT0iMTc1LjU4ODkiPmNsYXNzIFk6IC4uLjwvdGV4dD48L2c+PCEtLWVudGl0eSBCMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMSIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X0IxIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMS42MzA5IiB4PSI3IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iMTciIHk9IjI5Ljk5NTEiPkIxLnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS42MzA5IiB4PSIxNyIgeT0iNDYuMjkyIj5mcm9tIEEgaW1wb3J0IFg8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQjItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQjIiIGRhdGEtc291cmNlLWxpbmU9IjExIiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9CMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzAuNTkxOCIgeD0iMTc0LjUiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC4xMzM4IiB4PSIxODQuNSIgeT0iMjkuOTk1MSI+QjIucHk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjU5MTgiIHg9IjE4NC41IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgWTwvdGV4dD48L2c+PCEtLWVudGl0eSBCMy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMyIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0IzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC41OTE4IiB4PSIzNDAuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjM1MC41IiB5PSIyOS45OTUxIj5CMy5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNTkxOCIgeD0iMzUwLjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCBZPC90ZXh0PjwvZz48IS0tZW50aXR5IEI0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkI0IiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfQjQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI5LjA0IiB4PSI1MDYuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjUxNi41IiB5PSIyOS45OTUxIj5CNC5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuMDQiIHg9IjUxNi41IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgKjwvdGV4dD48L2c+PCEtLWxpbmsgQjEgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCMSIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJsbms3IiBpZD0ibGlua19CMV9BIj48cGF0aCBkPSJNMTI2LjYzLDYwLjAzIEMxNzEuNTQsODEuNCAyMjkuNTEyMiwxMDkuMDAxOCAyNzIuMDAyMiwxMjkuMjIxOCIgZmlsbD0ibm9uZSIgaWQ9IkIxLXRvLUEiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjRkYwMDAwIiBwb2ludHM9IjI3Ny40MiwxMzEuOCwyNzEuMDEyMSwxMjQuMzIwOCwyNzIuOTA1MSwxMjkuNjUxNSwyNjcuNTc0NSwxMzEuNTQ0NiwyNzcuNDIsMTMxLjgiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQjIgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCMiIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJsbms4IiBpZD0ibGlua19CMl9BIj48cGF0aCBkPSJNMjU3LjgxLDYwLjAzIEMyNzAsNzcuNTEgMjgyLjg2NzksOTUuOTU4NSAyOTYuMTE3OSwxMTQuOTU4NSIgZmlsbD0ibm9uZSIgaWQ9IkIyLXRvLUEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMDAwMDAwIiBwb2ludHM9IjI5OS41NSwxMTkuODgsMjk3LjY4MjksMTEwLjIwOTcsMjk2LjY4OTksMTE1Ljc3ODgsMjkxLjEyMDksMTE0Ljc4NTgsMjk5LjU1LDExOS44OCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBCMyB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIzIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImxuazkiIGlkPSJsaW5rX0IzX0EiPjxwYXRoIGQ9Ik0zODguMTksNjAuMDMgQzM3Niw3Ny41MSAzNjMuMTMyMSw5NS45NTg1IDM0OS44ODIxLDExNC45NTg1IiBmaWxsPSJub25lIiBpZD0iQjMtdG8tQSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMwMDAwMDAiIHBvaW50cz0iMzQ2LjQ1LDExOS44OCwzNTQuODc5MSwxMTQuNzg1OCwzNDkuMzEwMSwxMTUuNzc4OCwzNDguMzE3MSwxMTAuMjA5NywzNDYuNDUsMTE5Ljg4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEI0IHRvIEEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQjQiIGRhdGEtZW50aXR5LTI9IkEiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBkYXRhLXVpZD0ibG5rMTAiIGlkPSJsaW5rX0I0X0EiPjxwYXRoIGQ9Ik01MTcuOCw2MC4wMyBDNDczLjM5LDgxLjM0IDQxNi4xNzkyLDEwOC43ODM4IDM3NC4wMjkyLDEyOS4wMTM4IiBmaWxsPSJub25lIiBpZD0iQjQtdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMzY4LjYyLDEzMS42MSwzNzguNDY0NiwxMzEuMzIxOSwzNzMuMTI3NywxMjkuNDQ2NSwzNzUuMDAzMSwxMjQuMTA5NiwzNjguNjIsMTMxLjYxIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1TUkM9W1RPelYydThtNUNOVl9IR05VbWlxX0ZDYUNqMi1YOTh6QjVxYkpaVmtYOTNla3hTczhZcnhrdnBwRXNUZHJ4UFhlNFE2SjhvSlA4eGdzYTVJZjNxV2dxU3dOM1kza21FRzJzbU94V0tOMjJURXd5dnZwRFdDS1RwY3ZhZkRjWTloUjBxWEZ2dFFxdXNWRHp0Q2JyQ3JmRk5CSlJIQlFhd0xXWTgxdF9WSmRUNTlETFlyREFlQkw0NHNCeWEzcXQ5NmVKVDJzcWsxOG5JNm9tRE9CNWg0bWZMT1FNRlgwZXAtV3o0Mlo1VjBoR05aaG81d2NOVk9RRU5lNFZzVEYwSkY3ajd4WUVWMDRtMDBdLS0+PC9nPjwvc3ZnPg==" width="641" height="194" class="img_ev3q"></p>
<p>But the types a module depends on are not only from imports. Imagine a program like this with a chained method call:</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> module </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Class</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token class-name">Class</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">returns_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">operation_on_type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Even though we only import <code>Class</code>, this module still depends on the type returned in <code>returns_type()</code>.</p>
<p>Similarly, <code>returns_type()</code> could be implemented in a <code>base</code> of <code>Class</code>, so we really might be depending on a class hierarchy instead of just <code>Class</code> from <code>module</code>.</p>
<p>And should a change to an unrelated part of numpy invalidate this program (i.e. recheck the module)? Probably not.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">array </span><span class="token operator">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, a program’s type dependency structure is much more complicated and expansive than it might originally appear.</p>
<p>Since Pyrefly v0.51.1, we no longer invalidate a module any time a dependency changes. We now track exactly which types the module depends on at lookup to prune the modules that must be recomputed. In load-bearing files like the example in the introduction, this change turns what could be a 2000+ module invalidation into an invalidation of just over 100 modules.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-2-streaming-diagnostics">Solution 2: Streaming diagnostics<a href="#solution-2-streaming-diagnostics" class="hash-link" aria-label="Direct link to Solution 2: Streaming diagnostics" title="Direct link to Solution 2: Streaming diagnostics">​</a></h2>
<p>The other key insight from earlier is that we’re waiting for the update to finish completely before refreshing the errors in the IDE. To improve this, we could stream updated diagnostics to the IDE as soon as an open file has been rechecked, without waiting for other modules to be rechecked.</p>
<p>Let’s imagine a project with a dependency structure that looks like this. A is the file that we are editing, and B is another file that we have open, which is affected by edits to the types in A. As a user, what we want is for changes we make in A to be reflected in B with minimal delay.</p>
<p><img decoding="async" loading="lazy" alt="nodes diagram" src="/assets/images/a_b_nodes_1-cffa3f5be4e5da33c5e60e6265fbffbb.png" width="1188" height="1272" class="img_ev3q"></p>
<p>Highlighted in red are the reverse dependencies of A, which may need to be rechecked if A is updated. Previously, we would recheck all the red modules before updating the diagnostics for B.</p>
<p><img decoding="async" loading="lazy" alt="nodes diagram red" src="/assets/images/a_b_nodes_2-6d195abd0e35afb699adaa1b328affa4.png" width="1372" height="1308" class="img_ev3q"></p>
<p>Highlighted in blue are the transitive dependencies of B. Only changes to those modules affect the types and diagnostics for B.</p>
<p><img decoding="async" loading="lazy" alt="nodes diagram blue" src="/assets/images/a_b_nodes_3-fa2d797636189819a2e2bccd6d667ab1.png" width="1338" height="1330" class="img_ev3q"></p>
<p>The image below shows the intersection of A’s reverse dependencies and B’s dependencies in purple. Once those modules are checked, we can show updated diagnostics for open files to the user, while continuing to check the remaining modules (red) in the background.</p>
<p><img decoding="async" loading="lazy" alt="nodes diagram purple" src="/assets/images/a_b_nodes_4-e1cc33ac035b998695e777955e10b1b5.png" width="1402" height="1442" class="img_ev3q"></p>
<p>In order to provide a smooth IDE experience, Pyrefly runs language server operations (e.g. hover, autocomplete, go-to-def) on one thread and rechecks on another thread,  that way users can still use language server features while a recheck is happening in the background. Previously, the main language server thread would send updated diagnostics to the IDE, and only did so once it received a signal from the recheck thread that a recheck had finished. Now with streaming diagnostics in Pyrefly v0.52.0, the recheck thread can emit the diagnostics to the frontend directly.</p>
<p>This change means that diagnostics can now be emitted from both the main thread and the recheck thread. To prevent conflicts between diagnostics sent from different threads, we add a restriction so that only one thread may send diagnostics for a given file at a given time. When a recheck is ongoing, the main thread cannot send diagnostics for any files eligible for streaming diagnostics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="results">Results<a href="#results" class="hash-link" aria-label="Direct link to Results" title="Direct link to Results">​</a></h2>
<p>Combined, these two optimizations enable Pyrefly to provide updated diagnostics 18x faster than before. Going back to the example from the introduction, these changes reduce the diagnostic update time from ~3.6 seconds to under 200ms on an M4 Macbook Pro. For users, this means type errors refresh instantly after saving a file, a dramatic improvement:</p>
<video src="/videos/18x_faster.mp4" width="720" muted="" loop="" autoplay="" playsinline="" preload="auto"></video>
<p>To see how we benchmarked this, you can check out testing instructions on GitHub <a href="https://github.com/facebook/pyrefly/pull/2344" target="_blank" rel="noopener noreferrer">here</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What’s Next?<a href="#whats-next" class="hash-link" aria-label="Direct link to What’s Next?" title="Direct link to What’s Next?">​</a></h2>
<p>This was a tricky case to fix and we’ve made significant progress, but how fast is fast enough?</p>
<p>Speed continues to be a top priority for us on the Pyrefly team. While we’ve addressed the core problem, we’re always on the lookout for opportunities to further optimize performance, so stay tuned for further updates and make sure to regularly update your Pyrefly version. As we move toward v1, we’re carefully weighing additional speed improvements alongside other critical priorities like memory efficiency, bug fixes, and enhanced inference capabilities. Our goal is to deliver the fastest experience possible without compromising on overall functionality.</p>
<p>As always, if you’ve found a problem, please let us know by <a href="https://github.com/facebook/pyrefly/issues" target="_blank" rel="noopener noreferrer">opening a GitHub issue</a>.</p>
<p>And if you’ve made it this far, thanks for journeying down this rabbit hole with us! We hope you give Pyrefly a try if you haven’t already, see you for the next update!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/language-server/">language-server</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ide/">IDE</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/performance/">performance</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/type-narrowing/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">4 Pyrefly Type Narrowing Patterns that make Type Checking more Intuitive</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The Problem</a><ul><li><a href="#how-incremental-updates-work-in-pyrefly" class="table-of-contents__link toc-highlight">How Incremental Updates Work in Pyrefly</a></li></ul></li><li><a href="#solution-1-fine-grained-dependency-tracking" class="table-of-contents__link toc-highlight">Solution 1: Fine-grained dependency tracking</a></li><li><a href="#solution-2-streaming-diagnostics" class="table-of-contents__link toc-highlight">Solution 2: Streaming diagnostics</a></li><li><a href="#results" class="table-of-contents__link toc-highlight">Results</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What’s Next?</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community &amp; Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/Cf7mFQtW7W" target="_blank" rel="noopener noreferrer" class="footer__link-item">Join Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/pyrefly" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open a Github issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/MuFSdD7uCr?event=1389635637090713672" target="_blank" rel="noopener noreferrer" class="footer__link-item">Attend Office Hours<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.fb.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/meta_open_source_logo.svg" alt="Meta Open Source Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/meta_open_source_logo.svg" alt="Meta Open Source Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>