"use strict";(self.webpackChunknew_website=self.webpackChunknew_website||[]).push([[7157],{139:e=>{e.exports=JSON.parse('{"permalink":"/blog/2026/02/06/performance-improvements","source":"@site/blog/2026-02-06-performance-improvements.mdx","title":"Making Pyrefly Diagnostics 18x Faster","description":"Learn about the recent performance improvements made to Pyrefly\'s language server capabilities","date":"2026-02-06T00:00:00.000Z","tags":[{"inline":true,"label":"language-server","permalink":"/blog/tags/language-server"},{"inline":true,"label":"IDE","permalink":"/blog/tags/ide"},{"inline":true,"label":"performance","permalink":"/blog/tags/performance"}],"readingTime":6.515,"hasTruncateMarker":true,"authors":[{"name":"Abby Mitchell","url":"https://github.com/javabster","key":"abbym","page":null},{"name":"Kyle Into","url":"https://www.kylei.dev/","key":"kylei","page":null},{"name":"Danny Yang","url":"https://github.com/yangdanny97","key":"yangdanny","page":null}],"frontMatter":{"title":"Making Pyrefly Diagnostics 18x Faster","description":"Learn about the recent performance improvements made to Pyrefly\'s language server capabilities","authors":["abbym","kylei","yangdanny"],"tags":["language-server","IDE","performance"],"image":"https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png","hide_table_of_contents":false},"unlisted":false,"nextItem":{"title":"4 Pyrefly Type Narrowing Patterns that make Type Checking more Intuitive","permalink":"/blog/type-narrowing"}}')},5589:(e,i,a)=>{a.d(i,{A:()=>n});const n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjE5NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQxcHg7aGVpZ2h0OjE5NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0MSAxOTQiIHdpZHRoPSI2NDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgQS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9BIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY4Ljg5MDYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkxLjMxMjUiIHg9IjI3Ny41IiB5PSIxMjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMS4xOTkyIiB4PSIyODcuNSIgeT0iMTQyLjk5NTEiPkEucHk8L3RleHQ+PHRleHQgZmlsbD0iI0ZGMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuMzEyNSIgeD0iMjg3LjUiIHk9IjE1OS4yOTIiPmNsYXNzIFg6IC4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MC4yNzM0IiB4PSIyODcuNSIgeT0iMTc1LjU4ODkiPmNsYXNzIFk6IC4uLjwvdGV4dD48L2c+PCEtLWVudGl0eSBCMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMSIgZGF0YS1zb3VyY2UtbGluZT0iNiIgZGF0YS11aWQ9ImVudDAwMDMiIGlkPSJlbnRpdHlfQjEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMxLjYzMDkiIHg9IjciIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC4xMzM4IiB4PSIxNyIgeT0iMjkuOTk1MSI+QjEucHk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTExLjYzMDkiIHg9IjE3IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgWDwvdGV4dD48L2c+PCEtLWVudGl0eSBCMi0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMiIgZGF0YS1zb3VyY2UtbGluZT0iNyIgZGF0YS11aWQ9ImVudDAwMDQiIGlkPSJlbnRpdHlfQjIiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMwLjU5MTgiIHg9IjE3NC41IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iMTg0LjUiIHk9IjI5Ljk5NTEiPkIyLnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMC41OTE4IiB4PSIxODQuNSIgeT0iNDYuMjkyIj5mcm9tIEEgaW1wb3J0IFk8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQjMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQjMiIGRhdGEtc291cmNlLWxpbmU9IjgiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0IzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC41OTE4IiB4PSIzNDAuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjM1MC41IiB5PSIyOS45OTUxIj5CMy5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNTkxOCIgeD0iMzUwLjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCBZPC90ZXh0PjwvZz48IS0tZW50aXR5IEI0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkI0IiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwNiIgaWQ9ImVudGl0eV9CNCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjkuMDQiIHg9IjUwNi41IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iNTE2LjUiIHk9IjI5Ljk5NTEiPkI0LnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwOS4wNCIgeD0iNTE2LjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCAqPC90ZXh0PjwvZz48IS0tbGluayBCMSB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIxIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxMCIgZGF0YS11aWQ9ImxuazciIGlkPSJsaW5rX0IxX0EiPjxwYXRoIGQ9Ik0xMjYuNjMsNjAuMDMgQzE3MS41NCw4MS40IDIyOS41MTIyLDEwOS4wMDE4IDI3Mi4wMDIyLDEyOS4yMjE4IiBmaWxsPSJub25lIiBpZD0iQjEtdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMjc3LjQyLDEzMS44LDI3MS4wMTIxLDEyNC4zMjA4LDI3Mi45MDUxLDEyOS42NTE1LDI2Ny41NzQ1LDEzMS41NDQ2LDI3Ny40MiwxMzEuOCIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBCMiB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIyIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxMSIgZGF0YS11aWQ9ImxuazgiIGlkPSJsaW5rX0IyX0EiPjxwYXRoIGQ9Ik0yNTcuODEsNjAuMDMgQzI3MCw3Ny41MSAyODIuODY3OSw5NS45NTg1IDI5Ni4xMTc5LDExNC45NTg1IiBmaWxsPSJub25lIiBpZD0iQjItdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMjk5LjU1LDExOS44OCwyOTcuNjgyOSwxMTAuMjA5NywyOTYuNjg5OSwxMTUuNzc4OCwyOTEuMTIwOSwxMTQuNzg1OCwyOTkuNTUsMTE5Ljg4IiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEIzIHRvIEEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQjMiIGRhdGEtZW50aXR5LTI9IkEiIGRhdGEtc291cmNlLWxpbmU9IjEyIiBkYXRhLXVpZD0ibG5rOSIgaWQ9ImxpbmtfQjNfQSI+PHBhdGggZD0iTTM4OC4xOSw2MC4wMyBDMzc2LDc3LjUxIDM2My4xMzIxLDk1Ljk1ODUgMzQ5Ljg4MjEsMTE0Ljk1ODUiIGZpbGw9Im5vbmUiIGlkPSJCMy10by1BIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iI0ZGMDAwMCIgcG9pbnRzPSIzNDYuNDUsMTE5Ljg4LDM1NC44NzkxLDExNC43ODU4LDM0OS4zMTAxLDExNS43Nzg4LDM0OC4zMTcxLDExMC4yMDk3LDM0Ni40NSwxMTkuODgiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQjQgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCNCIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGRhdGEtdWlkPSJsbmsxMCIgaWQ9ImxpbmtfQjRfQSI+PHBhdGggZD0iTTUxNy44LDYwLjAzIEM0NzMuMzksODEuMzQgNDE2LjE3OTIsMTA4Ljc4MzggMzc0LjAyOTIsMTI5LjAxMzgiIGZpbGw9Im5vbmUiIGlkPSJCNC10by1BIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iI0ZGMDAwMCIgcG9pbnRzPSIzNjguNjIsMTMxLjYxLDM3OC40NjQ2LDEzMS4zMjE5LDM3My4xMjc3LDEyOS40NDY1LDM3NS4wMDMxLDEyNC4xMDk2LDM2OC42MiwxMzEuNjEiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLVNSQz1bVFN2MTJlQ200ME5HVkt1bmsyb09lZDRiOFhXbGVVMGNRNWdhY2VJOUs0aGZ0UGljTTJsT3RWM19vc0ppUkxINmU5VzFQUnk4VFBxYUYwYTBycFg4aEZNYXFKSzNVSDd4YkhNWWxjX0x6WjJnZzdicWdrV19OVXd3aWYtNGpUM2FHMmFqcFp1bEVuTklyZ1NIMjBsTHhuQVUtMnFOckV1aDY2VVpTTzc2RXZ4aU83ZTBzbTNKN01KXzhUbDF4MDJVMGltOEpvMkVJdFNpSnpVMWhLQ01YWlMwXS0tPjwvZz48L3N2Zz4="},9705:(e,i,a)=>{a.d(i,{A:()=>n});const n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjE5NHB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjQxcHg7aGVpZ2h0OjE5NHB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDY0MSAxOTQiIHdpZHRoPSI2NDFweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PGRlZnMvPjxnPjwhLS1lbnRpdHkgQS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJBIiBkYXRhLXNvdXJjZS1saW5lPSI5IiBkYXRhLXVpZD0iZW50MDAwMiIgaWQ9ImVudGl0eV9BIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjY4Ljg5MDYiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjkxLjMxMjUiIHg9IjI3Ny41IiB5PSIxMjAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMS4xOTkyIiB4PSIyODcuNSIgeT0iMTQyLjk5NTEiPkEucHk8L3RleHQ+PHRleHQgZmlsbD0iI0ZGMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEuMzEyNSIgeD0iMjg3LjUiIHk9IjE1OS4yOTIiPmNsYXNzIFg6IC4uLjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MC4yNzM0IiB4PSIyODcuNSIgeT0iMTc1LjU4ODkiPmNsYXNzIFk6IC4uLjwvdGV4dD48L2c+PCEtLWVudGl0eSBCMS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMSIgZGF0YS1zb3VyY2UtbGluZT0iMTAiIGRhdGEtdWlkPSJlbnQwMDAzIiBpZD0iZW50aXR5X0IxIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMS42MzA5IiB4PSI3IiB5PSI3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDAuMTMzOCIgeD0iMTciIHk9IjI5Ljk5NTEiPkIxLnB5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMS42MzA5IiB4PSIxNyIgeT0iNDYuMjkyIj5mcm9tIEEgaW1wb3J0IFg8L3RleHQ+PC9nPjwhLS1lbnRpdHkgQjItLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLWVudGl0eT0iQjIiIGRhdGEtc291cmNlLWxpbmU9IjExIiBkYXRhLXVpZD0iZW50MDAwNCIgaWQ9ImVudGl0eV9CMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI1Mi41OTM4IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzAuNTkxOCIgeD0iMTc0LjUiIHk9IjciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MC4xMzM4IiB4PSIxODQuNSIgeT0iMjkuOTk1MSI+QjIucHk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjU5MTgiIHg9IjE4NC41IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgWTwvdGV4dD48L2c+PCEtLWVudGl0eSBCMy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtZW50aXR5PSJCMyIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGRhdGEtdWlkPSJlbnQwMDA1IiBpZD0iZW50aXR5X0IzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEzMC41OTE4IiB4PSIzNDAuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjM1MC41IiB5PSIyOS45OTUxIj5CMy5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTAuNTkxOCIgeD0iMzUwLjUiIHk9IjQ2LjI5MiI+ZnJvbSBBIGltcG9ydCBZPC90ZXh0PjwvZz48IS0tZW50aXR5IEI0LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1lbnRpdHk9IkI0IiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgZGF0YS11aWQ9ImVudDAwMDYiIGlkPSJlbnRpdHlfQjQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI5LjA0IiB4PSI1MDYuNSIgeT0iNyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQwLjEzMzgiIHg9IjUxNi41IiB5PSIyOS45OTUxIj5CNC5weTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDkuMDQiIHg9IjUxNi41IiB5PSI0Ni4yOTIiPmZyb20gQSBpbXBvcnQgKjwvdGV4dD48L2c+PCEtLWxpbmsgQjEgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCMSIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGRhdGEtdWlkPSJsbms3IiBpZD0ibGlua19CMV9BIj48cGF0aCBkPSJNMTI2LjYzLDYwLjAzIEMxNzEuNTQsODEuNCAyMjkuNTEyMiwxMDkuMDAxOCAyNzIuMDAyMiwxMjkuMjIxOCIgZmlsbD0ibm9uZSIgaWQ9IkIxLXRvLUEiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjRkYwMDAwIiBwb2ludHM9IjI3Ny40MiwxMzEuOCwyNzEuMDEyMSwxMjQuMzIwOCwyNzIuOTA1MSwxMjkuNjUxNSwyNjcuNTc0NSwxMzEuNTQ0NiwyNzcuNDIsMTMxLjgiIHN0eWxlPSJzdHJva2U6I0ZGMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgQjIgdG8gQS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJCMiIgZGF0YS1lbnRpdHktMj0iQSIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGRhdGEtdWlkPSJsbms4IiBpZD0ibGlua19CMl9BIj48cGF0aCBkPSJNMjU3LjgxLDYwLjAzIEMyNzAsNzcuNTEgMjgyLjg2NzksOTUuOTU4NSAyOTYuMTE3OSwxMTQuOTU4NSIgZmlsbD0ibm9uZSIgaWQ9IkIyLXRvLUEiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMDAwMDAwIiBwb2ludHM9IjI5OS41NSwxMTkuODgsMjk3LjY4MjksMTEwLjIwOTcsMjk2LjY4OTksMTE1Ljc3ODgsMjkxLjEyMDksMTE0Ljc4NTgsMjk5LjU1LDExOS44OCIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBCMyB0byBBLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9IkIzIiBkYXRhLWVudGl0eS0yPSJBIiBkYXRhLXNvdXJjZS1saW5lPSIxNiIgZGF0YS11aWQ9ImxuazkiIGlkPSJsaW5rX0IzX0EiPjxwYXRoIGQ9Ik0zODguMTksNjAuMDMgQzM3Niw3Ny41MSAzNjMuMTMyMSw5NS45NTg1IDM0OS44ODIxLDExNC45NTg1IiBmaWxsPSJub25lIiBpZD0iQjMtdG8tQSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMwMDAwMDAiIHBvaW50cz0iMzQ2LjQ1LDExOS44OCwzNTQuODc5MSwxMTQuNzg1OCwzNDkuMzEwMSwxMTUuNzc4OCwzNDguMzE3MSwxMTAuMjA5NywzNDYuNDUsMTE5Ljg4IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1saW5rIEI0IHRvIEEtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iQjQiIGRhdGEtZW50aXR5LTI9IkEiIGRhdGEtc291cmNlLWxpbmU9IjE3IiBkYXRhLXVpZD0ibG5rMTAiIGlkPSJsaW5rX0I0X0EiPjxwYXRoIGQ9Ik01MTcuOCw2MC4wMyBDNDczLjM5LDgxLjM0IDQxNi4xNzkyLDEwOC43ODM4IDM3NC4wMjkyLDEyOS4wMTM4IiBmaWxsPSJub25lIiBpZD0iQjQtdG8tQSIgc3R5bGU9InN0cm9rZTojRkYwMDAwO3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiNGRjAwMDAiIHBvaW50cz0iMzY4LjYyLDEzMS42MSwzNzguNDY0NiwxMzEuMzIxOSwzNzMuMTI3NywxMjkuNDQ2NSwzNzUuMDAzMSwxMjQuMTA5NiwzNjguNjIsMTMxLjYxIiBzdHlsZT0ic3Ryb2tlOiNGRjAwMDA7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjwhLS1TUkM9W1RPelYydThtNUNOVl9IR05VbWlxX0ZDYUNqMi1YOTh6QjVxYkpaVmtYOTNla3hTczhZcnhrdnBwRXNUZHJ4UFhlNFE2SjhvSlA4eGdzYTVJZjNxV2dxU3dOM1kza21FRzJzbU94V0tOMjJURXd5dnZwRFdDS1RwY3ZhZkRjWTloUjBxWEZ2dFFxdXNWRHp0Q2JyQ3JmRk5CSlJIQlFhd0xXWTgxdF9WSmRUNTlETFlyREFlQkw0NHNCeWEzcXQ5NmVKVDJzcWsxOG5JNm9tRE9CNWg0bWZMT1FNRlgwZXAtV3o0Mlo1VjBoR05aaG81d2NOVk9RRU5lNFZzVEYwSkY3ajd4WUVWMDRtMDBdLS0+PC9nPjwvc3ZnPg=="},15888:(e,i,a)=>{a.d(i,{A:()=>n});const n=a.p+"assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png"},28453:(e,i,a)=>{a.d(i,{R:()=>s,x:()=>d});var n=a(96540);const t={},I=n.createContext(t);function s(e){const i=n.useContext(I);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),n.createElement(I.Provider,{value:i},e.children)}},28706:(e,i,a)=>{a.d(i,{A:()=>n});const n=a.p+"assets/images/a_b_nodes_4-e1cc33ac035b998695e777955e10b1b5.png"},37157:(e,i,a)=>{a.r(i),a.d(i,{assets:()=>l,contentTitle:()=>d,default:()=>r,frontMatter:()=>s,metadata:()=>n,toc:()=>o});var n=a(139),t=a(74848),I=a(28453);const s={title:"Making Pyrefly Diagnostics 18x Faster",description:"Learn about the recent performance improvements made to Pyrefly's language server capabilities",authors:["abbym","kylei","yangdanny"],tags:["language-server","IDE","performance"],image:"https://pyrefly.org/assets/images/18x_faster-064e9ea631da625f6e1a88464b444f95.png",hide_table_of_contents:!1},d=void 0,l={authorsImageUrls:[void 0,void 0,void 0]},o=[{value:"The Problem",id:"the-problem",level:2},{value:"How Incremental Updates Work in Pyrefly",id:"how-incremental-updates-work-in-pyrefly",level:3},{value:"Solution 1: Fine-grained dependency tracking",id:"solution-1-fine-grained-dependency-tracking",level:2},{value:"Solution 2: Streaming diagnostics",id:"solution-2-streaming-diagnostics",level:2},{value:"Results",id:"results",level:2},{value:"What\u2019s Next?",id:"whats-next",level:2}];function c(e){const i={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,I.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"Hero image",src:a(15888).A+"",width:"1216",height:"644"})}),"\n",(0,t.jsxs)(i.p,{children:["As we move closer to a stable release of Pyrefly, our efforts have moved from expanding the language server\u2019s capabilities to tackling performance edge cases. Recently, our friends at Astral ",(0,t.jsx)(i.a,{href:"https://astral.sh/blog/ty",children:"alerted us to a specific edge case"})," that is a great example of the kind of issues we\u2019ve been aiming to uncover. The specific example Astral highlighted showed that in some edge cases Pyrefly could take multiple seconds to update diagnostics after editing. This is much slower than expected (used across Meta\u2019s codebases, Pyrefly usually takes less than 10 milliseconds to recheck files after saving them) and prompted us to investigate further."]}),"\n",(0,t.jsx)(i.p,{children:"Now we\u2019d like to share the story of how that edge case led us to rethink our underlying approach to diagnostics and dependency tracking, improving the speed at which Pyrefly's type errors update by 18x in the process."}),"\n",(0,t.jsx)(i.h2,{id:"the-problem",children:"The Problem"}),"\n",(0,t.jsx)(i.p,{children:"Say you\u2019re working in a very large codebase and have two files open in your editor, A and B."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"A is a \u201cload-bearing\u201d file that has many reverse dependencies - that is to say, many files directly or transitively import A."}),"\n",(0,t.jsx)(i.li,{children:"B is one of the files that imports A."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Incremental type checking should be snappy - when you edit A and save the file, any effects on the type errors in B should be reflected almost instantly. However, in a small number of cases, we found that updates could take multiple seconds."}),"\n",(0,t.jsx)(i.h3,{id:"how-incremental-updates-work-in-pyrefly",children:"How Incremental Updates Work in Pyrefly"}),"\n",(0,t.jsx)(i.p,{children:"To understand how this problem arises, we need to look at how incremental updates currently work. Pyrefly\u2019s analysis operates at the module level, meaning it keeps track of the types exported from each module, as well as the dependencies between modules. Let\u2019s illustrate with a simple example."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"import diagram",src:a(5589).A+"",width:"641",height:"194"})}),"\n",(0,t.jsx)(i.p,{children:"The above image demonstrates a file A that has 4 reverse-dependencies. B1-B4 all rely on the types exported from A."}),"\n",(0,t.jsx)(i.p,{children:"When file A is edited & saved, we recheck A to see if any of its exported types also change. If so, we recheck every file that imports A (and if any of those files\u2019 exports changed, we recheck their dependencies, and so on until the change to A has been successfully propagated everywhere). After all of that finishes, we display updated errors in the IDE."}),"\n",(0,t.jsx)(i.p,{children:"There are two key observations here:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Our dependency tracking rechecks a module when ",(0,t.jsx)(i.em,{children:"any"})," export changes, even if the module does not depend on the export that changed. This can lead to modules being rechecked unnecessarily."]}),"\n",(0,t.jsx)(i.li,{children:"We are waiting until the update has completely propagated to every affected file before sending any updated diagnostics, when in practice we mostly care about the files the user has open."}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"solution-1-fine-grained-dependency-tracking",children:"Solution 1: Fine-grained dependency tracking"}),"\n",(0,t.jsx)(i.p,{children:"Instead of just tracking whether or not a module depends on another module for invalidation, we can specifically track what\u2019s used."}),"\n",(0,t.jsx)(i.p,{children:"Looking again at the example above, instead of rechecking everything that imports A, with smarter dependency tracking we could only recheck a subset of relevant files:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"import diagram improved",src:a(9705).A+"",width:"641",height:"194"})}),"\n",(0,t.jsx)(i.p,{children:"But the types a module depends on are not only from imports. Imagine a program like this with a chained method call:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-py",children:"from module import Class\nClass().returns_type().operation_on_type()\n"})}),"\n",(0,t.jsxs)(i.p,{children:["Even though we only import ",(0,t.jsx)(i.code,{children:"Class"}),", this module still depends on the type returned in ",(0,t.jsx)(i.code,{children:"returns_type()"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["Similarly, ",(0,t.jsx)(i.code,{children:"returns_type()"})," could be implemented in a ",(0,t.jsx)(i.code,{children:"base"})," of ",(0,t.jsx)(i.code,{children:"Class"}),", so we really might be depending on a class hierarchy instead of just ",(0,t.jsx)(i.code,{children:"Class"})," from ",(0,t.jsx)(i.code,{children:"module"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"And should a change to an unrelated part of numpy invalidate this program (i.e. recheck the module)? Probably not."}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-py",children:"import numpy as np\narray = np.ones(1)\n"})}),"\n",(0,t.jsx)(i.p,{children:"As you can see, a program\u2019s type dependency structure is much more complicated and expansive than it might originally appear."}),"\n",(0,t.jsx)(i.p,{children:"Since Pyrefly v0.51.1, we no longer invalidate a module any time a dependency changes. We now track exactly which types the module depends on at lookup to prune the modules that must be recomputed. In load-bearing files like the example in the introduction, this change turns what could be a 2000+ module invalidation into an invalidation of just over 100 modules."}),"\n",(0,t.jsx)(i.h2,{id:"solution-2-streaming-diagnostics",children:"Solution 2: Streaming diagnostics"}),"\n",(0,t.jsx)(i.p,{children:"The other key insight from earlier is that we\u2019re waiting for the update to finish completely before refreshing the errors in the IDE. To improve this, we could stream updated diagnostics to the IDE as soon as an open file has been rechecked, without waiting for other modules to be rechecked."}),"\n",(0,t.jsx)(i.p,{children:"Let\u2019s imagine a project with a dependency structure that looks like this. A is the file that we are editing, and B is another file that we have open, which is affected by edits to the types in A. As a user, what we want is for changes we make in A to be reflected in B with minimal delay."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"nodes diagram",src:a(74415).A+"",width:"1188",height:"1272"})}),"\n",(0,t.jsx)(i.p,{children:"Highlighted in red are the reverse dependencies of A, which may need to be rechecked if A is updated. Previously, we would recheck all the red modules before updating the diagnostics for B."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"nodes diagram red",src:a(52948).A+"",width:"1372",height:"1308"})}),"\n",(0,t.jsx)(i.p,{children:"Highlighted in blue are the transitive dependencies of B. Only changes to those modules affect the types and diagnostics for B."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"nodes diagram blue",src:a(74077).A+"",width:"1338",height:"1330"})}),"\n",(0,t.jsx)(i.p,{children:"The image below shows the intersection of A\u2019s reverse dependencies and B\u2019s dependencies in purple. Once those modules are checked, we can show updated diagnostics for open files to the user, while continuing to check the remaining modules (red) in the background."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"nodes diagram purple",src:a(28706).A+"",width:"1402",height:"1442"})}),"\n",(0,t.jsx)(i.p,{children:"In order to provide a smooth IDE experience, Pyrefly runs language server operations (e.g. hover, autocomplete, go-to-def) on one thread and rechecks on another thread,  that way users can still use language server features while a recheck is happening in the background. Previously, the main language server thread would send updated diagnostics to the IDE, and only did so once it received a signal from the recheck thread that a recheck had finished. Now with streaming diagnostics in Pyrefly v0.52.0, the recheck thread can emit the diagnostics to the frontend directly."}),"\n",(0,t.jsx)(i.p,{children:"This change means that diagnostics can now be emitted from both the main thread and the recheck thread. To prevent conflicts between diagnostics sent from different threads, we add a restriction so that only one thread may send diagnostics for a given file at a given time. When a recheck is ongoing, the main thread cannot send diagnostics for any files eligible for streaming diagnostics."}),"\n",(0,t.jsx)(i.h2,{id:"results",children:"Results"}),"\n",(0,t.jsx)(i.p,{children:"Combined, these two optimizations enable Pyrefly to provide updated diagnostics 18x faster than before. Going back to the example from the introduction, these changes reduce the diagnostic update time from ~3.6 seconds to under 200ms on an M4 Macbook Pro. For users, this means type errors refresh instantly after saving a file, a dramatic improvement:"}),"\n",(0,t.jsx)("video",{src:"/videos/18x_faster.mp4",width:"720",muted:!0,loop:!0,autoPlay:!0,playsInline:!0,preload:"auto"}),"\n",(0,t.jsxs)(i.p,{children:["To see how we benchmarked this, you can check out testing instructions on GitHub ",(0,t.jsx)(i.a,{href:"https://github.com/facebook/pyrefly/pull/2344",children:"here"})]}),"\n",(0,t.jsx)(i.h2,{id:"whats-next",children:"What\u2019s Next?"}),"\n",(0,t.jsx)(i.p,{children:"This was a tricky case to fix and we\u2019ve made significant progress, but how fast is fast enough?"}),"\n",(0,t.jsx)(i.p,{children:"Speed continues to be a top priority for us on the Pyrefly team. While we\u2019ve addressed the core problem, we\u2019re always on the lookout for opportunities to further optimize performance, so stay tuned for further updates and make sure to regularly update your Pyrefly version. As we move toward v1, we\u2019re carefully weighing additional speed improvements alongside other critical priorities like memory efficiency, bug fixes, and enhanced inference capabilities. Our goal is to deliver the fastest experience possible without compromising on overall functionality."}),"\n",(0,t.jsxs)(i.p,{children:["As always, if you\u2019ve found a problem, please let us know by ",(0,t.jsx)(i.a,{href:"https://github.com/facebook/pyrefly/issues",children:"opening a GitHub issue"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"And if you\u2019ve made it this far, thanks for journeying down this rabbit hole with us! We hope you give Pyrefly a try if you haven\u2019t already, see you for the next update!"})]})}function r(e={}){const{wrapper:i}={...(0,I.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},52948:(e,i,a)=>{a.d(i,{A:()=>n});const n=a.p+"assets/images/a_b_nodes_2-6d195abd0e35afb699adaa1b328affa4.png"},74077:(e,i,a)=>{a.d(i,{A:()=>n});const n=a.p+"assets/images/a_b_nodes_3-fa2d797636189819a2e2bccd6d667ab1.png"},74415:(e,i,a)=>{a.d(i,{A:()=>n});const n=a.p+"assets/images/a_b_nodes_1-cffa3f5be4e5da33c5e60e6265fbffbb.png"}}]);