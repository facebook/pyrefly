"use strict";(globalThis.webpackChunknew_website=globalThis.webpackChunknew_website||[]).push([[2520],{52520(e,n,r){r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"django","title":"Experimental Django Support","description":"Pyrefly experimental support for Django ORM.","source":"@site/docs/django.mdx","sourceDirName":".","slug":"/django","permalink":"/en/docs/django","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/pyrefly/edit/main/website/docs/django.mdx","tags":[],"version":"current","frontMatter":{"title":"Experimental Django Support","description":"Pyrefly experimental support for Django ORM."},"sidebar":"docsSidebar","previous":{"title":"Lax Mode Type Conversions","permalink":"/en/docs/pydantic-lax-conversions"},"next":{"title":"Error Suppressions","permalink":"/en/docs/error-suppressions"}}');var l=r(74848),i=r(28453);const o={title:"Experimental Django Support",description:"Pyrefly experimental support for Django ORM."},a="Experimental Django Support",t={},d=[{value:"Feedback",id:"feedback",level:3},{value:"What is Django?",id:"what-is-django",level:2},{value:"Getting Started with Django and Pyrefly",id:"getting-started-with-django-and-pyrefly",level:2},{value:"1. Install django-stubs and set up a virtual environment",id:"1-install-django-stubs-and-set-up-a-virtual-environment",level:3},{value:"2. Install pyrefly (version 0.42.0 or later)",id:"2-install-pyrefly-version-0420-or-later",level:3},{value:"How Pyrefly Supports Django",id:"how-pyrefly-supports-django",level:2},{value:"Supported Features with Examples",id:"supported-features-with-examples",level:2},{value:"Auto-Generated Fields",id:"auto-generated-fields",level:3},{value:"Primary Key: <code>id</code> Field",id:"primary-key-id-field",level:4},{value:"Custom Primary Keys",id:"custom-primary-keys",level:4},{value:"ForeignKey <code>_id</code> Suffix Fields",id:"foreignkey-_id-suffix-fields",level:4},{value:"ForeignKey Relationships",id:"foreignkey-relationships",level:3},{value:"Basic Forward Access",id:"basic-forward-access",level:4},{value:"Chained Access",id:"chained-access",level:4},{value:"Nullable ForeignKeys",id:"nullable-foreignkeys",level:4},{value:"ManyToManyField Relationships",id:"manytomanyfield-relationships",level:3},{value:"Forward Managers",id:"forward-managers",level:4},{value:"Django Model Enums",id:"django-model-enums",level:3},{value:"Differences from Mypy",id:"differences-from-mypy",level:2},{value:"Type Representation Differences",id:"type-representation-differences",level:3},{value:"Features Not Yet Supported",id:"features-not-yet-supported",level:2},{value:"Reverse Relationships",id:"reverse-relationships",level:3},{value:"Advanced QuerySet Operations",id:"advanced-queryset-operations",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:["\n",(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"experimental-django-support",children:"Experimental Django Support"})}),"\n",(0,l.jsxs)(n.p,{children:["Pyrefly includes ",(0,l.jsx)(n.strong,{children:"experimental support"})," for ",(0,l.jsx)(n.a,{href:"https://www.djangoproject.com/",children:"Django"}),", a popular Python web framework. This feature aims to provide improved static type checking for Django's Object-Relational Mapping (ORM) system, which is used to interact with databases."]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note:"})," This support is experimental and currently covers a subset of Django's ORM features. The implementation is actively evolving based on feedback and development. We currently support Django models, fields, and basic relationships."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"feedback",children:"Feedback"}),"\n",(0,l.jsxs)(n.p,{children:["We welcome your feedback and suggestions. Please share your thoughts and ideas by opening an issue on ",(0,l.jsx)(n.a,{href:"https://github.com/facebook/pyrefly/issues",children:"GitHub"}),"."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"what-is-django",children:"What is Django?"}),"\n",(0,l.jsx)(n.p,{children:"Django is a high-level Python web framework. One of its core components is the Object-Relational Mapping (ORM) system, which allows developers to interact with databases using Python classes (models) instead of writing SQL queries directly."}),"\n",(0,l.jsx)(n.p,{children:"Django models define the structure of your database tables, and Django automatically handles the creation and management of the underlying database schema."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"getting-started-with-django-and-pyrefly",children:"Getting Started with Django and Pyrefly"}),"\n",(0,l.jsx)(n.p,{children:"To use Pyrefly with Django, follow these steps:"}),"\n",(0,l.jsx)(n.h3,{id:"1-install-django-stubs-and-set-up-a-virtual-environment",children:"1. Install django-stubs and set up a virtual environment"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Install django-stubs\npip install django-stubs\n\n# Create and activate a virtual environment\npython3 -m venv .venv\nsource .venv/bin/activate\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-install-pyrefly-version-0420-or-later",children:"2. Install pyrefly (version 0.42.0 or later)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pip install pyrefly\n"})}),"\n",(0,l.jsx)(n.p,{children:"That's it! Pyrefly will automatically recognize Django constructs and provide appropriate type checking."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"how-pyrefly-supports-django",children:"How Pyrefly Supports Django"}),"\n",(0,l.jsx)(n.p,{children:"Pyrefly provides type inference for Django's ORM without requiring any plugins or manual configuration. It:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Recognizes Django model classes that inherit from ",(0,l.jsx)(n.code,{children:"models.Model"})]}),"\n",(0,l.jsxs)(n.li,{children:["Understands Django field types (",(0,l.jsx)(n.code,{children:"CharField"}),", ",(0,l.jsx)(n.code,{children:"IntegerField"}),", ",(0,l.jsx)(n.code,{children:"ForeignKey"}),", etc.)"]}),"\n",(0,l.jsxs)(n.li,{children:["Infers types for auto-generated fields (like ",(0,l.jsx)(n.code,{children:"id"})," and ",(0,l.jsx)(n.code,{children:"pk"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Handles relationships between models (",(0,l.jsx)(n.code,{children:"ForeignKey"}),", ",(0,l.jsx)(n.code,{children:"ManyToManyField"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Provides special enum support"}),"\n",(0,l.jsx)(n.li,{children:"Provides immediate feedback when the code has type errors"}),"\n",(0,l.jsxs)(n.li,{children:["Does ",(0,l.jsx)(n.strong,{children:"not"})," require a plugin or manual config \u2014 support is built-in and automatic"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"supported-features-with-examples",children:"Supported Features with Examples"}),"\n",(0,l.jsx)(n.p,{children:"The following examples showcase which Django features are currently supported by Pyrefly. This is a subset of Django's full feature set, but covers the most common use cases."}),"\n",(0,l.jsx)(n.h3,{id:"auto-generated-fields",children:"Auto-Generated Fields"}),"\n",(0,l.jsx)(n.p,{children:"Django automatically adds certain fields to every model, even if you don't define them explicitly."}),"\n",(0,l.jsxs)(n.h4,{id:"primary-key-id-field",children:["Primary Key: ",(0,l.jsx)(n.code,{children:"id"})," Field"]}),"\n",(0,l.jsxs)(n.p,{children:["By default, Django automatically adds an ",(0,l.jsx)(n.code,{children:"id"})," field to serve as the primary key (unless you define a custom primary key):"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from django.db import models\n\nclass Reporter(models.Model):\n    full_name = models.CharField(max_length=70)\n    # Django auto-adds: id = models.AutoField(primary_key=True)\n\nreporter = Reporter()\nreveal_type(reporter.id)  # Pyrefly infers: int\n"})}),"\n",(0,l.jsx)(n.h4,{id:"custom-primary-keys",children:"Custom Primary Keys"}),"\n",(0,l.jsxs)(n.p,{children:["If you define a field with ",(0,l.jsx)(n.code,{children:"primary_key=True"}),", Django will not add the ",(0,l.jsx)(n.code,{children:"id"})," field. Pyrefly correctly infers the type of custom primary keys:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from django.db import models\n\nclass Reporter(models.Model):\n    uuid = models.UUIDField(primary_key=True)\n    full_name = models.CharField(max_length=70)\n\nreporter = Reporter()\nreveal_type(reporter.uuid)  # Pyrefly infers: UUID\nreveal_type(reporter.pk)  # Pyrefly infers: UUID (pk aliases the custom primary key)\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"foreignkey-_id-suffix-fields",children:["ForeignKey ",(0,l.jsx)(n.code,{children:"_id"})," Suffix Fields"]}),"\n",(0,l.jsxs)(n.p,{children:["For every ",(0,l.jsx)(n.code,{children:"ForeignKey"})," field named ",(0,l.jsx)(n.code,{children:"X"}),", Django automatically creates a field named ",(0,l.jsx)(n.code,{children:"X_id"})," that stores the ID of the related object:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class Article(models.Model):\n    reporter = models.ForeignKey(Reporter, on_delete=models.CASCADE)\n    # Django auto-adds: reporter_id: int\n\narticle = Article()\nreveal_type(article.reporter_id)  # Pyrefly infers: int\n"})}),"\n",(0,l.jsx)(n.h3,{id:"foreignkey-relationships",children:"ForeignKey Relationships"}),"\n",(0,l.jsxs)(n.p,{children:["A ",(0,l.jsx)(n.code,{children:"ForeignKey"})," creates a many-to-one relationship where each instance of one model relates to an instance of another model."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from django.db import models\n\nclass Reporter(models.Model):\n    full_name = models.CharField(max_length=70)\n\nclass Article(models.Model):\n    reporter = models.ForeignKey(Reporter, on_delete=models.CASCADE)\n"})}),"\n",(0,l.jsx)(n.h4,{id:"basic-forward-access",children:"Basic Forward Access"}),"\n",(0,l.jsxs)(n.p,{children:["Accessing a ",(0,l.jsx)(n.code,{children:"ForeignKey"})," field returns an instance of the related model:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"article = Article()\nreveal_type(article.reporter)  # Pyrefly infers: Reporter\n"})}),"\n",(0,l.jsx)(n.h4,{id:"chained-access",children:"Chained Access"}),"\n",(0,l.jsx)(n.p,{children:"You can access fields on the related model:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"reveal_type(article.reporter.full_name)  # Pyrefly infers: str\n"})}),"\n",(0,l.jsx)(n.h4,{id:"nullable-foreignkeys",children:"Nullable ForeignKeys"}),"\n",(0,l.jsxs)(n.p,{children:["If a ",(0,l.jsx)(n.code,{children:"ForeignKey"})," has ",(0,l.jsx)(n.code,{children:"null=True"}),", Pyrefly reflects this in the inferred type:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class Article(models.Model):\n    reporter = models.ForeignKey(Reporter, null=True, on_delete=models.CASCADE)\n\narticle = Article()\nreveal_type(article.reporter)  # Pyrefly infers: Reporter | None\n"})}),"\n",(0,l.jsx)(n.h3,{id:"manytomanyfield-relationships",children:"ManyToManyField Relationships"}),"\n",(0,l.jsxs)(n.p,{children:["A ",(0,l.jsx)(n.code,{children:"ManyToManyField"})," creates a many-to-many relationship where instances of one model can be related to multiple instances of another model."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class Author(models.Model):\n    name = models.CharField(max_length=100)\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name='books')\n"})}),"\n",(0,l.jsx)(n.h4,{id:"forward-managers",children:"Forward Managers"}),"\n",(0,l.jsxs)(n.p,{children:["Accessing a ",(0,l.jsx)(n.code,{children:"ManyToManyField"})," returns a manager object that provides methods to interact with the related objects:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"book = Book()\nreveal_type(book.authors)  # Pyrefly infers: ManyRelatedManager[Author, Model]\nreveal_type(book.authors.all())  # Pyrefly infers: QuerySet[Author, Author]\n"})}),"\n",(0,l.jsxs)(n.p,{children:["The manager provides methods like ",(0,l.jsx)(n.code,{children:".add()"}),", ",(0,l.jsx)(n.code,{children:".remove()"}),", ",(0,l.jsx)(n.code,{children:".clear()"}),", and ",(0,l.jsx)(n.code,{children:".all()"})," to manage the relationship."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"django-model-enums",children:"Django Model Enums"}),"\n",(0,l.jsxs)(n.p,{children:["Pyrefly supports Django's model choices using ",(0,l.jsx)(n.code,{children:"Choices"}),", ",(0,l.jsx)(n.code,{children:"IntegerChoices"}),", and ",(0,l.jsx)(n.code,{children:"TextChoices"}),". These provide type-safe enumerations for model fields."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from django.db import models\n\nclass Vehicle(models.IntegerChoices):\n    CAR = 1, "Car"\n    TRUCK = 2, "Truck"\n    MOTORCYCLE = 3, "Motorcycle"\n\nclass Product(models.Model):\n    vehicle_type = models.IntegerField(choices=Vehicle.choices)\n\n# Pyrefly correctly infers enum types\nreveal_type(Vehicle.CAR.value)  # Pyrefly infers: int\nreveal_type(Vehicle.CAR.label)  # Pyrefly infers: str\nreveal_type(Vehicle.values)  # Pyrefly infers: list[int]\nreveal_type(Vehicle.choices)  # Pyrefly infers: list[tuple[int, str]]\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Pyrefly also supports ",(0,l.jsx)(n.code,{children:"TextChoices"})," and the base ",(0,l.jsx)(n.code,{children:"Choices"})," class with various value types including ",(0,l.jsx)(n.code,{children:"enum.auto()"})," for automatic value generation."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"differences-from-mypy",children:"Differences from Mypy"}),"\n",(0,l.jsxs)(n.p,{children:["Mypy uses a plugin (",(0,l.jsx)(n.code,{children:"mypy-django-plugin"}),") that provides very detailed type information by accessing runtime Django internals and performing multiple passes over the code. Pyrefly takes a different approach by following the type stubs directly without runtime introspection."]}),"\n",(0,l.jsx)(n.h3,{id:"type-representation-differences",children:"Type Representation Differences"}),"\n",(0,l.jsxs)(n.p,{children:["In some cases, such as ",(0,l.jsx)(n.code,{children:"ManyToManyField"})," relationships, Mypy and Pyrefly infer different types:"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from django.db import models\n\nclass Author(models.Model):\n    name = models.CharField(max_length=100)\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name="books")\n\nclass Article(models.Model):\n    headline = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name="articles")\n\n# What types do the managers have?\nbook = Book()\narticle = Article()\n'})}),"\n",(0,l.jsx)(n.p,{children:"Mypy (with django plugin):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"book.authors"})," has type: ",(0,l.jsx)(n.code,{children:"Author_ManyRelatedManager[Book_authors]"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"article.authors"})," has type: ",(0,l.jsx)(n.code,{children:"Author_ManyRelatedManager[Article_authors]"})]}),"\n",(0,l.jsxs)(n.li,{children:["These are ",(0,l.jsx)(n.strong,{children:"different types"})," (different class name, different type parameter)"]}),"\n",(0,l.jsxs)(n.li,{children:["Mypy will ",(0,l.jsx)(n.strong,{children:"reject"})," assigning one to the other"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Pyrefly (following stubs):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"book.authors"})," has type: ",(0,l.jsx)(n.code,{children:"ManyRelatedManager[Author, Model]"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"article.authors"})," has type: ",(0,l.jsx)(n.code,{children:"ManyRelatedManager[Author, Model]"})]}),"\n",(0,l.jsxs)(n.li,{children:["These are the ",(0,l.jsx)(n.strong,{children:"same type"})]}),"\n",(0,l.jsxs)(n.li,{children:["Pyrefly will ",(0,l.jsx)(n.strong,{children:"accept"})," assigning one to the other"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"features-not-yet-supported",children:"Features Not Yet Supported"}),"\n",(0,l.jsxs)(n.p,{children:["These are some of the Django features are ",(0,l.jsx)(n.strong,{children:"not yet supported"})," in this experimental release:"]}),"\n",(0,l.jsx)(n.h3,{id:"reverse-relationships",children:"Reverse Relationships"}),"\n",(0,l.jsxs)(n.p,{children:["Django automatically creates reverse relationships for ",(0,l.jsx)(n.code,{children:"ForeignKey"})," and ",(0,l.jsx)(n.code,{children:"ManyToManyField"}),". For example:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"class Reporter(models.Model):\n    full_name = models.CharField(max_length=70)\n\nclass Article(models.Model):\n    reporter = models.ForeignKey(Reporter, on_delete=models.CASCADE)\n\n# Not yet supported:\nreporter = Reporter()\nreveal_type(reporter.article_set)  # Expected: RelatedManager[Article]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"advanced-queryset-operations",children:"Advanced QuerySet Operations"}),"\n",(0,l.jsxs)(n.p,{children:["While basic ",(0,l.jsx)(n.code,{children:".all()"})," operations are supported, more complex QuerySet operations may not have complete type inference."]}),"\n",(0,l.jsx)(n.p,{children:"Those are not the only unsupported features, so if there are specific features you would like to see, please request them by opening a github issue and adding the Django label to it."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>o,x:()=>a});var s=r(96540);const l={},i=s.createContext(l);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);